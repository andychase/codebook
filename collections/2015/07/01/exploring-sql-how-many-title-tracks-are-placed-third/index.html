<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Codebook: Exploring sql: how many title tracks are placed third?</title>
  <meta name="description" content="I was listening to Florance + The Machine’s newest album when I noticed that a lot of music albums place their title track third on the album. Is this really...">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://codebook.snc.io/collections/2015/07/01/exploring-sql-how-many-title-tracks-are-placed-third/">
  <link rel="alternate" type="application/rss+xml" title="Codebook: Software Development Resources" href="https://codebook.snc.io/feed.xml" />
</head>


  <body>

    <header class="site-header">
    <div class="wrapper">
            <span class="site-icon">0100 0100 0101 0000 1001 1000</span>
            <a class="site-title " href="/">Codebook: Software Development Resources</a>
        <nav class="site-nav">
            <ul>
                <li class="active">
                    <a class="page-link" href="/">Collections</a>
                </li>
                
                
                <li class="">
                    <a class="page-link" href="/topics/databases/">Databases</a>
                </li>
                
                
                
                
                
                <li class="">
                    <a class="page-link" href="/topics/music/">Music</a>
                </li>
                
                
                
                
                
                <li class="">
                    <a class="page-link" href="/topics/web/">Web</a>
                </li>
                
                
                
                

                <li class="nav-right ">
                    <a class="page-link" href="/about/">About</a>
                </li>
            </ul>
        </nav>
    </div>
</header>


    

    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Exploring SQL: How many title tracks are placed third?</h1>
    <p class="post-meta">Jul 1, 2015 • Andy Chase</p>
  </header>

  <article class="post-content">
    <p>I was listening to <a href="http://pitchfork.com/reviews/albums/20605-how-big-how-blue-how-beautiful/">Florance + The Machine</a>’s newest album when I noticed that a lot of music albums place their title track third on the album. Is this really the case I wonder? Well, having some abilities in Data Science I decided to see if I could get a chart out how many albums have title tracks and where they land.</p>

<h1 id="getting-the-data">1. Getting the data</h1>

<p>First in order to answer this question I’m going to need some data to work with.</p>

<p>Music Brainz is a “MusicBrainz is a community-maintained open source encyclopedia of music information” (<a href="https://musicbrainz.org/doc/About">About</a>). Since their data is open and freely available it seems like a good source.</p>

<div class="link_block">
    
    <div class="commentary">
        <span>
        <p>Has all the music metadata you need</p>

        </span>
    </div>
    

    <div class="icon">
        <span class="ss-barchart"></span>
        
    </div>
    <a class="link_url" href="https://musicbrainz.org/doc/MusicBrainz_Database/Download">
        MusicBrainz Database / Download
    </a>

    <div class="more_link_data">
        <span class="domain">
        <a href="https://musicbrainz.org">musicbrainz.org</a>,
        </span>
        
        <span class="date">2015,</span>
        
        <span class="authors">
        
        
        
            by <a href="https://about.me/stefankestenholz">Stefan Kestenholz</a> <a href="https://wiki.musicbrainz.org/User:Keschte/OfficialBio">[&amp;]</a>,
            
            and Other MusicBrainz Contributors
        
        </span>
        
        
    </div>

    
    <div class="description">
        
        <p>MusicBrainz started in 2000 by <a href="http://mayhem-chaos.net/">Robert Kaye</a> who needed a place to store metadata files for the an unix cd player called Workman. Today MusicBrainz has metadata for 15 million records by almost a million artists worldwide (<a href="https://en.wikipedia.org/wiki/MusicBrainz">Wikipedia Contributors, 2015</a>)  (<a href="https://musicbrainz.org/doc/About/History">MusicBrains: About</a>).</p>

<p>MusicBrains has expanded their open data effort into <a href="https://metabrainz.org/">MetaBrains</a> which also warehouses data for Music Cover Art, Music Criticism, and Books as well.</p>

        
    </div>
    

    
    <div class="link_feedback_link">
    <span class="ss-ellipsis"></span>
    <form action="/" class="link_feedback_form">
        <span class="ss-like feedback_icon"></span>
        <textarea name="like" placeholder="I like the link because..."></textarea>
        <br />
        <span class="ss-dislike feedback_icon"></span>
        <textarea name="dislike" placeholder="I don't like the link because..."></textarea>
        <br />
        <input type="hidden" value="MusicBrainz Database / Download" />
        <span class="link_feedback_success"></span>
        <input class="link_feedback_link_button" type="submit" value="Submit" />
    </form>
</div>


</div>

<h1 id="setting-up-an-environment">2. Setting up an environment</h1>

<ol>
  <li>Set up a virtual server on <a href="//digitalocean.com/?refcode=d91055f0c205">Digital Ocean</a> (<a href="//digitalocean.com">non-ref</a>) to work on. <em>Optional:</em> I like working on another server because a remote server has a lot of bandwidth so I can get the data quickly, and I can feel good about downloading a lot of remote scripts and dependencies without harming my local environment.</li>
  <li>Followed the MusicBrainz instructions on setting up the database: <a href="https://bitbucket.org/lalinsky/mbslave">MusicBrainz Database Setup</a>.</li>
</ol>

<h1 id="ask-my-question">3. Ask my question</h1>

<p>So the goal here is now to ask the questions I have about title tracks to the database. I’m going to be querying SQL here to do this.</p>

<div class="link_block">
    
    <div class="commentary">
        <span>
        <p>Has good introductory information, but <a href="//w3fools.com">w3fools</a> recommends that you don’t stop at introduction tutorials.</p>

        </span>
    </div>
    

    <div class="icon">
        <span class="ss-signpost"></span>
        
    </div>
    <a class="link_url" href="http://www.w3schools.com/sql/">
        SQL Tutorial
    </a>

    <div class="more_link_data">
        <span class="domain">
        <a href="http://w3schools.com">w3schools.com</a>,
        </span>
        
        <span class="date">2000,</span>
        
        <span class="authors">
        
            by W3Schools/Refsnes Data
        
        
        
        </span>
        
        
    </div>

    
    <div class="description">
        
        <p>W3Schools is a website aimed at educating people of the very basics of web technology.</p>

        
    </div>
    

    
    <div class="link_feedback_link">
    <span class="ss-ellipsis"></span>
    <form action="/" class="link_feedback_form">
        <span class="ss-like feedback_icon"></span>
        <textarea name="like" placeholder="I like the link because..."></textarea>
        <br />
        <span class="ss-dislike feedback_icon"></span>
        <textarea name="dislike" placeholder="I don't like the link because..."></textarea>
        <br />
        <input type="hidden" value="SQL Tutorial" />
        <span class="link_feedback_success"></span>
        <input class="link_feedback_link_button" type="submit" value="Submit" />
    </form>
</div>


</div>

<p>First I have to study the <a href="https://musicbrainz.org/doc/MusicBrainz_Database/Schema">MusicBrainz Schema Diagram</a> to figure out what kind of queries I have to write in order to figure out how to answer my question.</p>

<h1 id="how-many-albums-have-title-tracks">How many albums have title tracks?</h1>

<p>In the schema above, I found that the <code>musicbrainz.medium</code> table contains the relationship between “releases” (albums releases essentially), and tracks. I need to see how many mediums have associated tracks with the same as that medium.</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="p">(</span><span class="n">medium</span><span class="p">.</span><span class="n">name</span><span class="p">))</span> <span class="c1">-- Select names that are different</span>
<span class="k">FROM</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">medium</span><span class="p">;</span>

 <span class="k">count</span>  <span class="c1">-- &lt;- Results</span>
<span class="c1">-------</span>
 <span class="mi">45</span><span class="p">,</span><span class="mi">374</span></code></pre></div>

<p>This is not what I expected, there should be at least a million albums out there. It turns out medium names are often blank for some reason, so I need to get the name from the release table instead. I’m going to also add in the <code>musicbrainz.release_group</code> table which will account for when there are multiple releases of one album.</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="p">(</span><span class="n">release_group</span><span class="p">.</span><span class="n">name</span><span class="p">))</span> 
<span class="k">FROM</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">medium</span> 
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">release</span> 
     <span class="k">ON</span> <span class="n">medium</span><span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">.</span><span class="n">id</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">release_group</span>
     <span class="k">ON</span> <span class="n">release_group</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">release</span><span class="p">.</span><span class="n">release_group</span><span class="p">;</span>

  <span class="k">count</span>  
<span class="c1">---------</span>
 <span class="mi">970</span><span class="p">,</span><span class="mi">467</span></code></pre></div>

<p>That’s better.</p>

<p>Now I just need to find out how many albums have title tracks;</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="p">(</span><span class="n">release_group</span><span class="p">.</span><span class="n">name</span><span class="p">))</span> 
<span class="k">FROM</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">medium</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">release</span> 
    <span class="k">ON</span> <span class="n">medium</span><span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">.</span><span class="n">id</span> 
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">track</span> 
    <span class="k">ON</span> <span class="n">track</span><span class="p">.</span><span class="n">medium</span> <span class="o">=</span> <span class="n">medium</span><span class="p">.</span><span class="n">id</span> 
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">release_group</span> 
    <span class="k">ON</span> <span class="n">release_group</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">release</span><span class="p">.</span><span class="n">release_group</span> 
<span class="k">WHERE</span> <span class="k">lower</span><span class="p">(</span><span class="n">track</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="o">=</span> <span class="k">lower</span><span class="p">(</span><span class="n">release_group</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
<span class="c1">-- ^ This is what finds the title track</span>
<span class="c1">-- ^ lower(track.name) so its case insensitive</span>

 <span class="k">count</span>  
<span class="c1">--------</span>
 <span class="mi">250</span><span class="p">,</span><span class="mi">241</span></code></pre></div>

<p>Now for some quick calculations…</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">releases</span> <span class="o">=</span> <span class="mi">970467</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">title_releases</span> <span class="o">=</span> <span class="mi">250241</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">title_releases</span> <span class="o">/</span> <span class="n">releases</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mf">0.25785626919823135</span></code></pre></div>

<p><code>26%</code>! That’s a massive number of albums from lazy artists who can’t be bothered to name all their songs without re-using the album name.</p>

<h1 id="where-are-the-title-tracks-placed-are-they-usually-third">Where are the title tracks placed (are they usually third)?</h1>

<p>To answer this question we need to take the results from above (finding tracks that are title tracks) and query over that data, grouping up the most common positions for those tracks and counting them.</p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">sub</span><span class="p">.</span><span class="k">position</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">sub</span><span class="p">.</span><span class="k">position</span><span class="p">)</span> 
<span class="k">FROM</span> <span class="p">(</span>
    <span class="k">SELECT</span> <span class="k">distinct</span> <span class="n">release_group</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">track</span><span class="p">.</span><span class="k">position</span> 
    <span class="k">FROM</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">medium</span>
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">release</span> 
        <span class="k">ON</span> <span class="n">medium</span><span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">release</span><span class="p">.</span><span class="n">id</span> 
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">track</span> 
        <span class="k">ON</span> <span class="n">track</span><span class="p">.</span><span class="n">medium</span> <span class="o">=</span> <span class="n">medium</span><span class="p">.</span><span class="n">id</span> 
    <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">musicbrainz</span><span class="p">.</span><span class="n">release_group</span> 
        <span class="k">ON</span> <span class="n">release_group</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">release</span><span class="p">.</span><span class="n">release_group</span> 
    <span class="k">WHERE</span> <span class="n">track</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">release_group</span><span class="p">.</span><span class="n">name</span>
    <span class="k">AND</span> <span class="n">track</span><span class="p">.</span><span class="k">position</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="c1">-- Only care about the first few</span>
    <span class="k">AND</span> <span class="n">medium</span><span class="p">.</span><span class="n">track_count</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="c1">-- Skip title-track only albums</span>
<span class="p">)</span> <span class="n">sub</span> 
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">sub</span><span class="p">.</span><span class="k">position</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">sub</span><span class="p">.</span><span class="n">pos</span><span class="p">;</span>

 <span class="k">position</span> <span class="o">|</span> <span class="k">count</span> 
<span class="c1">----------+-------</span>
        <span class="mi">0</span> <span class="o">|</span>     <span class="mi">4</span>
        <span class="mi">1</span> <span class="o">|</span> <span class="mi">73038</span>
        <span class="mi">2</span> <span class="o">|</span> <span class="mi">25044</span>
        <span class="mi">3</span> <span class="o">|</span> <span class="mi">18565</span>
        <span class="mi">4</span> <span class="o">|</span> <span class="mi">15792</span>
        <span class="mi">5</span> <span class="o">|</span> <span class="mi">13404</span>
        <span class="mi">6</span> <span class="o">|</span> <span class="mi">12464</span>
        <span class="mi">7</span> <span class="o">|</span> <span class="mi">10363</span>
        <span class="mi">8</span> <span class="o">|</span>  <span class="mi">8664</span>
        <span class="mi">9</span> <span class="o">|</span>  <span class="mi">7418</span></code></pre></div>

<p>As a nice chart:</p>

<p><img src="/images/2015-07-01-album_data.svg" alt="chart.png" class="fill" /></p>

<p>As you can see my hypothesis was incorrect, it seems that artists like put the title track first. Oh well, that seems to make sense, if you were to include a title track it would make sense to put it first.</p>

<p>Well I hope you were able to see how you one might answer questions you might have about data using open data and data analysis tools.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">
  <div class="wrapper">
    <ul>
  <li><a href="https://techstore.club"><span class="t">Tech</span><span class="s">Store</span><span class="c">Club</span></a></li>
  <li><a href="/about">About</a><a href="/about/terms">Terms</a><a href="/about/privacy">Privacy</a><a href="//github.com/techstoreclub/codebook">Source</a></li>
  <li><a href="https://creativecommons.org/licenses/by/4.0/">(CC BY 4.0)</a></li>
</ul>

  </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-64358500-1', 'auto');
  ga('send', 'pageview');

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="/js/script.js"></script>


  </body>

</html>
